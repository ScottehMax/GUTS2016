<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Roguecedural</title>
  <script type="text/javascript" src="/js/phaser.min.js"></script>
  <style type="text/css">
  </style>
</head>
<body>
  <script type="text/javascript">
    var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update });

    function preload() {

      var loadTargets = [
        'stone1.png',
        'stone2.png',
        'stone3.png',
        'wall1.png',
        'wall2.png',
        'wall3.png',
        'lava1.gif'
      ];

      for (var i = 0; i < loadTargets.length; i++) {
        game.load.image(loadTargets[i].split('.')[0], '/img/tiles/' + loadTargets[i]);
      }

    }

    var cursors, player;

    function create() {

      for (var x = 0; x <= 64; x++) {
        for (var y = 0; y <= 64; y++) {
          game.add.image(x*32, y*32, Math.floor(Math.random()*2) ? 'stone2' : 'stone1');
        }
      }

      game.world.setBounds(0, 0, 2048, 2048);

      game.physics.startSystem(Phaser.Physics.P2JS);

      player = game.add.sprite(game.world.centerX, game.world.centerY, 'lava1');

      game.physics.p2.enable(player);

      cursors = game.input.keyboard.createCursorKeys();

      game.camera.follow(player);

    }

    var isKeyPressed = false;

    function update() {
      player.body.setZeroVelocity();

      if (cursors.up.isDown) {
        if (isKeyPressed) return false;
        isKeyPressed = true;
        player.body.y -= 32;
      } else if (cursors.down.isDown) {
        if (isKeyPressed) return false;
        isKeyPressed = true;
        player.body.y += 32;
      } else if (cursors.left.isDown) {
        if (isKeyPressed) return false;
        isKeyPressed = true;
        player.body.x -= 32;
      } else if (cursors.right.isDown) {
        if (isKeyPressed) return false;
        isKeyPressed = true;
        player.body.x += 32;
      } else {
        isKeyPressed = false;
      }

    }
  </script>
</body>
</html>